{{ define "content" }}
<div class="container mt-4">

    <!-- Filter Form (separate from Restart Form) -->
    <form method="POST" action="/" id="filterForm">
        <div class="form-row">
            <div class="form-group col-md-3">
                <label for="awsAccountName">AWS Account Name</label>
                <select name="awsAccountName" class="form-control" onchange="submitForm()">
                    <option value="">All Accounts</option>
                    {{range .UniqueAWSAccountNames}}
                    <option value="{{.}}" {{if eq . $.SelectedAWSAccountName}}selected{{end}}>{{.}}</option>
                    {{end}}
                </select>
            </div>
            <div class="form-group col-md-3">
                <label for="service">Service</label>
                <select name="service" class="form-control" onchange="submitForm()">
                    <option value="">All Services</option>
                    {{range .UniqueServices}}
                    <option value="{{.}}" {{if eq . $.SelectedService}}selected{{end}}>{{.}}</option>
                    {{end}}
                </select>
            </div>
            <div class="form-group col-md-3">
                <label for="owner">Owner</label>
                <select name="owner" class="form-control" onchange="submitForm()">
                    <option value="">All Owners</option>
                    {{range .UniqueOwners}}
                    <option value="{{.}}" {{if eq . $.SelectedOwner}}selected{{end}}>{{.}}</option>
                    {{end}}
                </select>
            </div>
            <div class="form-group col-md-3">
                <label for="region">Region</label>
                <select name="region" class="form-control" onchange="submitForm()">
                    <option value="">All Regions</option>
                    {{range .UniqueRegions}}
                    <option value="{{.}}" {{if eq . $.SelectedRegion}}selected{{end}}>{{.}}</option>
                    {{end}}
                </select>
            </div>
        </div>
    </form>

    <!-- Form to Select Instances and Restart -->
    <form method="POST" action="/restart">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Select</th>
                    <th>AWS Account Name</th>
                    <th>State</th>
                    <th>Name</th>
                    <th>Instance ID</th>
                    <th>Service</th>
                    <th>Owner</th>
                    <th>Region</th>
                </tr>
            </thead>
            <tbody>
                {{if .Instances}}
                {{range .Instances}}
                <tr>
                    <td><input type="checkbox" name="instance_ids" value="{{.ID}}"></td>
                    <td>{{.AWSAccountName}}</td>
                    <td>{{.State}}</td>
                    <td>{{.EC2Name}}</td>
                    <td>{{.ID}}</td>
                    <td>{{.Service}}</td>
                    <td>{{.Owner}}</td>
                    <td>{{.Region}}</td>
                </tr>
                {{end}}
                {{else}}
                <tr>
                    <td colspan="8" class="text-center">No instances found for the selected criteria.</td>
                </tr>
                {{end}}
            </tbody>
        </table>

        {{ if .IsLoggedIn }}
            <button type="submit" class="btn btn-danger">Restart Selected Instances</button>
        {{ else }}
            <p class="text-center"><em>Log in to restart instances.</em></p>
        {{ end }}
    </form>
</div>

<!-- Optional JavaScript -->
<script>
    function submitForm() {
        document.getElementById('filterForm').submit();
    }
</script>
{{ end }}
